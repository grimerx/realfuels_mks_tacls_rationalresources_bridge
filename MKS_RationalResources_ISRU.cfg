// MKS_RationalResources_ISRU.cfg
// Optimizes Rational Resources ISRU converters for MKS production chains
// Integrates RR resource distributions with MKS drilling and refining
// Author: Auto-generated integration patch
// Last Updated: December 2025

// Enable Rational Resources converters for MKS chains
@PART[*]:HAS[@MODULE[ModuleResourceConverter]:HAS[#ConverterName = *Ore*]]:NEEDS[RationalResources,UmbraSpaceIndustries/MKS]:FOR[zzz_MKS_RationalResources_Integration]
{
    // Ensure ore smelting works with RR ore types
    @MODULE[ModuleResourceConverter]:HAS[#ConverterName = *Ore*]
    {
        // No changes needed - converters auto-detect available resources
    }
}

// Add MaterialKit production from RR resources
@PART[*]:HAS[@MODULE[ModuleResourceConverter]:HAS[#ConverterName = *Workshop*]]:NEEDS[RationalResources,UmbraSpaceIndustries/MKS]:FOR[zzz_MKS_RationalResources_Integration]
{
    MODULE:NEEDS[RationalResources]
    {
        name = ModuleResourceConverter
        ConverterName = Material Assembly (RationalResources)
        StartActionName = Start Assembly
        StopActionName = Stop Assembly
        ToggleActionName = Toggle Assembly
        AutoShutdown = true
        GeneratesHeat = false
        UseSpecialistBonus = true
        SpecialistEfficiencyFactor = 0.5
        SpecialistBonusBase = 0.1
        ExperienceEffect = EngineerSkill
        
        INPUT_RESOURCE
        {
            ResourceName = Metals
            Ratio = 0.0001  // Primary input
            FlowMode = STAGE_PRIORITY_FLOW
        }
        INPUT_RESOURCE
        {
            ResourceName = Polymers
            Ratio = 0.00005  // Secondary input
            FlowMode = STAGE_PRIORITY_FLOW
        }
        INPUT_RESOURCE
        {
            ResourceName = Chemicals
            Ratio = 0.000025  // Trace chemicals
            FlowMode = STAGE_PRIORITY_FLOW
        }
        INPUT_RESOURCE
        {
            ResourceName = ElectricCharge
            Ratio = 3.0
            FlowMode = ALL_VESSEL
        }
        
        OUTPUT_RESOURCE
        {
            ResourceName = MaterialKits
            Ratio = 0.0000625  // ~1:1.6 mass ratio for efficiency
            DumpExcess = false
            FlowMode = STAGE_PRIORITY_FLOW
        }
    }
}

// Water extraction optimization with RationalResources
@PART[*]:HAS[@MODULE[ModuleResourceConverter]:HAS[#ConverterName = *Water*]]:NEEDS[RationalResources,UmbraSpaceIndustries/MKS]:FOR[zzz_MKS_RationalResources_Integration]
{
    @MODULE[ModuleResourceConverter]:HAS[#ConverterName = *Water*]
    {
        // Boost efficiency slightly for RR integration
        @EfficiencyBoost = 1.1
    }
}

// Ice processing module for RationalResources
@PART[*]:HAS[@MODULE[ModuleResourceConverter]:HAS[#ConverterName = *Ice*]]:NEEDS[RationalResources,UmbraSpaceIndustries/MKS]:FOR[zzz_MKS_RationalResources_Integration]
{
    MODULE:NEEDS[RationalResources]
    {
        name = ModuleResourceConverter
        ConverterName = Ice Processing (RationalResources)
        StartActionName = Start Processing
        StopActionName = Stop Processing
        ToggleActionName = Toggle Processing
        AutoShutdown = true
        GeneratesHeat = false
        UseSpecialistBonus = true
        SpecialistEfficiencyFactor = 0.25
        SpecialistBonusBase = 0.05
        ExperienceEffect = ScienceSkill
        
        INPUT_RESOURCE
        {
            ResourceName = Water
            Ratio = 0.0002  // Or Ice if available
            FlowMode = STAGE_PRIORITY_FLOW
        }
        INPUT_RESOURCE
        {
            ResourceName = ElectricCharge
            Ratio = 0.75
            FlowMode = ALL_VESSEL
        }
        
        OUTPUT_RESOURCE
        {
            ResourceName = Oxygen
            Ratio = 0.0001  // Via electrolysis
            DumpExcess = false
            FlowMode = STAGE_PRIORITY_FLOW
        }
        OUTPUT_RESOURCE
        {
            ResourceName = LqdHydrogen
            Ratio = 0.00005  // Hydrogen byproduct
            DumpExcess = false
            FlowMode = STAGE_PRIORITY_FLOW
        }
    }
}

// Metal refining - optimize for RR Metals resource
@PART[*]:HAS[@MODULE[ModuleResourceConverter]:HAS[#ConverterName = *Refin*]]:NEEDS[RationalResources,UmbraSpaceIndustries/MKS]:FOR[zzz_MKS_RationalResources_Integration]
{
    @MODULE[ModuleResourceConverter]:HAS[#ConverterName = *Refin*]
    {
        // Ensure Metals output is present
        @OUTPUT_RESOURCE:HAS[#ResourceName[Metals]]
        {
            // Keep as-is, already optimized in RR
        }
    }
}

// Polymer production - RR Polymers resource
@PART[*]:HAS[@MODULE[ModuleResourceConverter]:HAS[#ConverterName = *Polymer*]]:NEEDS[RationalResources,UmbraSpaceIndustries/MKS]:FOR[zzz_MKS_RationalResources_Integration]
{
    @MODULE[ModuleResourceConverter]:HAS[#ConverterName = *Polymer*]
    {
        // Ensure Polymers output is present
        @OUTPUT_RESOURCE:HAS[#ResourceName[Polymers]]
        {
            // Keep as-is, already optimized in RR
        }
    }
}

// Chemical processing for MKS + RR integration
@PART[*]:HAS[@MODULE[ModuleResourceConverter]:HAS[#ConverterName = *Chemical*]]:NEEDS[RationalResources,UmbraSpaceIndustries/MKS]:FOR[zzz_MKS_RationalResources_Integration]
{
    MODULE:NEEDS[RationalResources]
    {
        name = ModuleResourceConverter
        ConverterName = Chemical Processing (RationalResources)
        StartActionName = Start Processing
        StopActionName = Stop Processing
        ToggleActionName = Toggle Processing
        AutoShutdown = true
        GeneratesHeat = false
        UseSpecialistBonus = true
        SpecialistEfficiencyFactor = 0.25
        SpecialistBonusBase = 0.05
        ExperienceEffect = ScienceSkill
        
        INPUT_RESOURCE
        {
            ResourceName = Minerals
            Ratio = 0.00005
            FlowMode = STAGE_PRIORITY_FLOW
        }
        INPUT_RESOURCE
        {
            ResourceName = ElectricCharge
            Ratio = 1.5
            FlowMode = ALL_VESSEL
        }
        
        OUTPUT_RESOURCE
        {
            ResourceName = Chemicals
            Ratio = 0.000025
            DumpExcess = false
            FlowMode = STAGE_PRIORITY_FLOW
        }
    }
}

// Machinery production - advanced assembly
@PART[*]:HAS[@MODULE[ModuleResourceConverter]:HAS[#ConverterName = *Machiner*]]:NEEDS[RationalResources,UmbraSpaceIndustries/MKS]:FOR[zzz_MKS_RationalResources_Integration]
{
    MODULE:NEEDS[RationalResources]
    {
        name = ModuleResourceConverter
        ConverterName = Machinery Assembly (Advanced)
        StartActionName = Start Assembly
        StopActionName = Stop Assembly
        ToggleActionName = Toggle Assembly
        AutoShutdown = true
        GeneratesHeat = false
        UseSpecialistBonus = true
        SpecialistEfficiencyFactor = 0.75
        SpecialistBonusBase = 0.15
        ExperienceEffect = EngineerSkill
        
        INPUT_RESOURCE
        {
            ResourceName = MaterialKits
            Ratio = 0.00005
            FlowMode = STAGE_PRIORITY_FLOW
        }
        INPUT_RESOURCE
        {
            ResourceName = SpecializedParts
            Ratio = 0.000025
            FlowMode = STAGE_PRIORITY_FLOW
        }
        INPUT_RESOURCE
        {
            ResourceName = RefinedExotics
            Ratio = 0.000010
            FlowMode = STAGE_PRIORITY_FLOW
        }
        INPUT_RESOURCE
        {
            ResourceName = ElectricCharge
            Ratio = 5.0
            FlowMode = ALL_VESSEL
        }
        
        OUTPUT_RESOURCE
        {
            ResourceName = Machinery
            Ratio = 0.000050
            DumpExcess = false
            FlowMode = STAGE_PRIORITY_FLOW
        }
    }
}

// Enable Rational Resources scanner compatibility
@MODULE[ModuleSCANresourceDisplay]:NEEDS[RationalResources,SCANsat]:FOR[SCANsat]
{
}

// Ensure RationalResources resources are recognized
@RESOURCE_DEFINITION:NEEDS[RationalResources]:FOR[RationalResources]
{
    name = Metals
    density = 8.0
    flowMode = STACK_PRIORITY_SEARCH
    transfer = PUMP
    isTweakable = true
    isVisible = true
}

@RESOURCE_DEFINITION:NEEDS[RationalResources]:FOR[RationalResources]
{
    name = Polymers
    density = 0.9
    flowMode = STACK_PRIORITY_SEARCH
    transfer = PUMP
    isTweakable = true
    isVisible = true
}

@RESOURCE_DEFINITION:NEEDS[RationalResources]:FOR[RationalResources]
{
    name = Chemicals
    density = 1.2
    flowMode = STACK_PRIORITY_SEARCH
    transfer = PUMP
    isTweakable = true
    isVisible = true
}

@RESOURCE_DEFINITION:NEEDS[RationalResources]:FOR[RationalResources]
{
    name = RefinedExotics
    density = 5.0
    flowMode = STACK_PRIORITY_SEARCH
    transfer = PUMP
    isTweakable = true
    isVisible = true
}
